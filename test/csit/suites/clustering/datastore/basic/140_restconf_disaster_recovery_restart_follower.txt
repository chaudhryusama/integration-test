*** Settings ***
Documentation     Test suite for RESTCONF RPC CAR PERSON 
Library           Collections
Library           ../../../../libraries/RequestsLibrary.py
Library           ../../../../libraries/Common.py
Library           ../../../../libraries/CrudLibrary.py
Library           ../../../../libraries/SettingsLibrary.py
Library           ../../../../libraries/UtilLibrary.py
Library           ../../../../libraries/ClusterStateLibrary.py
Variables         ../../../../variables/Variables.py

*** Variables ***
${REST_CONTEXT}    /restconf/config/
${KARAF_HOME}      /root/odl/dist
${USER_NAME}       root
${PASSWORD}        Ecp123
${CAR_SHARD}	   shard-car-config

*** Test Cases *** 
Stop All Controllers
    [Documentation]    Stop all the controllers in the cluster
    Stopcontroller    ${LEADER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Stopcontroller    ${FOLLOWER1}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Stopcontroller    ${FOLLOWER2}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    30
    KillController    ${LEADER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    KillController    ${FOLLOWER1}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    KillController    ${FOLLOWER2}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}


Clean All Journals
    [Documentation]    Clean the journals of all the controllers in the cluster
    CleanJournal    ${LEADER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    CleanJournal    ${FOLLOWER1}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    CleanJournal    ${FOLLOWER2}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    5

Start All Controllers
    [Documentation]    Start all the controllers in the cluster
    Startcontroller    ${LEADER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Startcontroller    ${FOLLOWER1}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Startcontroller    ${FOLLOWER2}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    120

Delete all cars
    [Documentation]    Delete all the cars from the system
	${resp}		DeleteAllCars	${LEADER}	${PORT}		0
	${resp}		GetCars	${LEADER}	${PORT}		0
	Should Be Equal As Strings    ${resp.status_code}    404
	

Delete all people
    [Documentation]    Delete all the people from the system
	${resp}		DeleteAllPersons	${LEADER}	${PORT}		0
	${resp}		GetPersons	${LEADER}	${PORT}    0	
	Should Be Equal As Strings    ${resp.status_code}    404

Add 20000 cars
    [Documentation]    Add 200 cars
	${resp}		AddCar	${LEADER}	${PORT}  ${200}
	Should Be Equal As Strings    ${resp.status_code}    204

Add 20000 people
    [Documentation]    Add 200 people
	${resp}		AddPerson	${LEADER}	${PORT}	${0}    
	${resp}		AddPerson	${LEADER}	${PORT}  ${200}
	Should Be Equal As Strings    ${resp.status_code}    204

Add Car Person mapping
    [Documentation]    Add Car Persons
	${resp}		AddCarPerson	${LEADER}	${PORT}	${0}	
	${resp}		BuyCar	${LEADER}	${PORT}	${200}	

Stop of of the followers
    ${followers}  GetFollowers  ${CAR_SHARD}  ${3}  ${3}  ${1}  8181  ${LEADER}  ${FOLLOWER1}  ${FOLLOWER2}
    ${CAR_FOLLOWER}    Set Variable    ${followers[0]}
    Set Suite Variable    ${CAR_FOLLOWER}
    Stopcontroller    ${CAR_FOLLOWER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    30
    KillController    ${CAR_FOLLOWER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}

Get all the cars from the other Follower
    ${followers}  GetFollowers  ${CAR_SHARD}  ${3}  ${3}  ${1}  8181  ${LEADER}  ${FOLLOWER1}  ${FOLLOWER2}
	${resp}		Getcars	${followers[0]}	${PORT}	${0}
	Should Be Equal As Strings    ${resp.status_code}    200
	Should Contain     ${resp.content}   manufacturer1

Restart the Stopped Follower
    Startcontroller   ${CAR_FOLLOWER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    120

Get all the cars from Stopped Follower
	${resp}		Getcars	${CAR_FOLLOWER}	${PORT}	${0}
	Should Be Equal As Strings    ${resp.status_code}    200
	Should Contain     ${resp.content}   manufacturer1

Cleanup All Controllers 
    [Documentation]    Stop all the controllers in the cluster
    Stopcontroller    ${LEADER}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Stopcontroller    ${FOLLOWER1}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Stopcontroller    ${FOLLOWER2}    ${USER_NAME}    ${PASSWORD}    ${KARAF_HOME}
    Sleep    30



